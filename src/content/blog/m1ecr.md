---
title: Next.jsコンテナイメージをECSにデプロイできなかった話
slug: m1-ecr
pubDate: '2024-01-31'
image: /assets/docker.png
category:
  - docker
  - aws
description: Next.jsコンテナイメージをecrにデプロイできなかった話
---

## 起こったこと
dockerコンテナで開発しており､AWSにデプロイする際､ECRにコンテナイメージをアップロードする必要があるのですが｡なぜかイメージのビルドで､npm run buildの部分で止まってしまう(時間だけが過ぎる)という現象に遭遇

##  やったこと1
dockerを最新のバージョンに入れ直してみたところ､イメージのビルドには成功したが､ECSのデプロイに失敗する

## やったこと2
このへんでもしかするとm1macで開発しているのが良くないのでは...と思い始める｡
ためしに部屋に転がっていたwindowsのノートPCのWSLに開発環境を移し､イメージをビルドしたところすんなりデプロイできた｡

## やったこと3
armでもx86用のビルドができるといわれるbuildxも試してみるも結果は変わらず､ビルド自体は成功するがデプロイに失敗するという結果に｡
また､Rosetta2でx86のDockerを起動しビルドするという方法も取ってみたが､想像以上にビルドが遅く､これは使い物にならないな､と判断した

## まとめ
x86で動くアプリケーションを開発する以上､開発環境もx86のマシンを使う必要があるなあと思った｡
環境構築のときからAppleシリコンの印象がずっと悪いので､今後はwsl2で開発していきます｡



